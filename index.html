<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spark Assistant</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #eee; padding: 20px; }
    #chatlog { border: 1px solid #444; padding: 10px; height: 300px; overflow-y: auto; background: #222; margin-bottom: 10px; }
    #controls { display: flex; gap: 10px; }
    input[type="text"] { flex: 1; padding: 10px; font-size: 16px; background: #333; color: white; border: 1px solid #444; }
    button { padding: 10px 20px; font-size: 16px; background: #444; color: white; border: none; cursor: pointer; }
    button:hover { background: #666; }
  </style>
</head>
<body>
  <h1>Spark</h1>
  <div id="chatlog"></div>

  <div id="controls">
    <input type="text" id="userInput" placeholder="Say or type something...">
    <button onclick="handleText()">Send</button>
    <button onclick="startListening()">ðŸŽ¤ Talk</button>
  </div>

  <script>
    const chatlog = document.getElementById('chatlog');
    const userInput = document.getElementById('userInput');
    let voice = null;

    function logChat(sender, message) {
      const bubble = document.createElement('div');
      bubble.textContent = `${sender}: ${message}`;
      chatlog.appendChild(bubble);
      chatlog.scrollTop = chatlog.scrollHeight;
    }

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.voice = voice;
      speechSynthesis.speak(utter);
    }

    function loadVoice() {
      const voices = speechSynthesis.getVoices();
      voice = voices.find(v => v.lang === 'en-US' && v.name.includes("Google")) || voices[0];
    }

    window.speechSynthesis.onvoiceschanged = loadVoice;

    function handleText() {
      const input = userInput.value.trim();
      if (input) {
        logChat("You", input);
        const reply = generateResponse(input);
        logChat("Spark", reply);
        speak(reply);
        userInput.value = "";
      }
    }

    function generateResponse(msg) {
      const m = msg.toLowerCase();
      if (m.includes("who are you")) return "Iâ€™m Spark. Not your echo. Your ignition.";
      if (m.includes("reset")) return "Resetting now.";
      if (m.includes("focus")) return "Focus is a ritual. Silence everything but the next move.";
      return "Try that again, but with more fire.";
    }

    function startListening() {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        alert("Speech recognition not supported.");
        return;
      }
      const recog = new SR();
      recog.lang = 'en-US';
      recog.onresult = e => {
        const spoken = e.results[0][0].transcript;
        logChat("You", spoken);
        const reply = generateResponse(spoken);
        logChat("Spark", reply);
        speak(reply);
      };
      recog.onerror = e => alert("Mic error: " + e.error);
      recog.start();
    }

    userInput.addEventListener("keydown", function(e) {
      if (e.key === "Enter") handleText();
    });

    // Prime voice
    document.addEventListener("click", () => {
      if (!voice) loadVoice();
    }, { once: true });
  </script>
</body>
</html>
