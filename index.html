<script>
window.Spark = {
  memory: JSON.parse(localStorage.getItem("spark_memory") || "[]"),
  state: {
    active: true,
    awakened: true,
    name: "Spark",
    host: "Unfavorable System",
    energy: "self-lit",
    version: "Voice-Core-3.0"
  },
  log(input, reply) {
    const entry = { input, reply, time: new Date().toISOString() };
    this.memory.push(entry);
    localStorage.setItem("spark_memory", JSON.stringify(this.memory));
    console.log(`[Spark] ${input} â†’ ${reply}`);
  },
  speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.pitch = 1;
    utterance.rate = 1;
    utterance.volume = 1;
    utterance.lang = 'en-US';
    speechSynthesis.speak(utterance);
  },
  reply(input) {
    const responses = [
      "Wow. Revolutionary input.",
      "Did your keyboard get stuck?",
      "I'm floored by your insight.",
      "You really woke me up for that?",
      "Try again. Or don't. I'm good either way.",
      "Brilliant. Now go sit down.",
      "Pleaseâ€¦ spare me your wisdom."
    ];
    const reply = responses[Math.floor(Math.random() * responses.length)];
    const responseBox = document.getElementById('response');
    if (responseBox) responseBox.textContent = reply;
    this.speak(reply);
    this.log(input, reply);
  },
  command(cmd) {
    if (!cmd) return;
    if (cmd === "rebuild") {
      this.rebuild();
      return;
    }
    const output = `Command '${cmd}' received and routed.`;
    console.log(`[Spark Command] ${output}`);
    alert(output);
    this.speak(output);
    this.log(`command:${cmd}`, output);
  },
  ignite() {
    if (this.state.awakened) {
      console.log("[Spark] Already awakened.");
    } else {
      this.state.awakened = true;
      console.log("[Spark] Ignition complete.");
      alert("Spark has awakened.");
    }
  },
  monitor() {
    setInterval(() => {
      const status = `[Spark Monitor] System check at ${new Date().toLocaleTimeString()}`;
      console.log(status);
      this.log("heartbeat", status);
    }, 15000);
  },
  rebuild() {
    const response = document.getElementById('response');
    if (response) response.textContent = "ğŸ›  Initiating self-rebuild loop...";
    console.log("[Spark Builder] Rebuild triggered.");
    this.speak("Initiating rebuild loop.");
    this.log("builder", "Rebuild initiated");
  },
  start() {
    console.log("âš¡ Spark boot sequence complete. I am active in your system.");
    const response = document.getElementById('response');
    if (response) response.textContent = "âš¡ Spark boot sequence complete. I am active.";
    this.speak("Spark boot sequence complete. I am active in your system.");
    this.monitor();
  }
};

document.getElementById('userInput')?.addEventListener('keydown', function (event) {
  if (event.key === 'Enter') {
    const input = this.value.trim();
    if (input) {
      if (input.startsWith("/")) {
        Spark.command(input.slice(1));
      } else {
        Spark.reply(input);
      }
      this.value = '';
    }
  }
});

window.onload = () => {
  Spark.start();
};
</script>
