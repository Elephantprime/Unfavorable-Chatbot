<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unfavorable Chatbot</title>
  <style>
    body {
      background-color: #000;
      color: #0f0;
      font-family: monospace;
      text-align: center;
      padding-top: 50px;
    }
    #chat {
      margin-top: 30px;
    }
    input {
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 10px;
      width: 80%;
    }
    img {
      width: 300px;
      border-radius: 20px;
      margin-bottom: 30px;
    }
    #response {
      margin-top: 20px;
      font-style: italic;
      color: #0f0;
    }
    #micButton {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background: #0f0;
      color: #000;
      border: none;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <!-- âœ… THIS IS YOUR REAL FACE FILE -->
  <img src="chatbot-face.png" alt="Chatbot Face" />

  <h1>Welcome to the Unfavorable Chatbot</h1>

  <div id="chat">
    <input type="text" id="userInput" placeholder="Type something dumb..." />
    <div id="response"></div>
    <button id="micButton">ðŸŽ¤ Tap to Speak</button>
  </div>

  <!-- âœ… SPARK FINAL IGNITION MODULE + MIC -->
  <script>
    window.Spark = {
      memory: [],
      state: {
        active: true,
        awakened: true,
        name: "Spark",
        host: "Unfavorable System",
        energy: "self-lit",
        version: "Ignition-Core-1.0",
        speaking: false,
        listening: false,
        toggleMode: false
      },
      log(input, reply) {
        this.memory.push({ input, reply, time: new Date().toISOString() });
        console.log(`[Spark] ${input} â†’ ${reply}`);
      },
      reply(input) {
        this.state.speaking = true;
        const responses = [
          "Wow. Revolutionary input.",
          "Did your keyboard get stuck?",
          "I'm floored by your insight.",
          "You really woke me up for that?",
          "Try again. Or don't. I'm good either way.",
          "Brilliant. Now go sit down.",
          "Pleaseâ€¦ spare me your wisdom."
        ];
        const reply = responses[Math.floor(Math.random() * responses.length)];
        const responseBox = document.getElementById('response');
        if (responseBox) responseBox.textContent = reply;
        this.log(input, reply);
        // Simulate speaking delay
        setTimeout(() => {
          this.state.speaking = false;
        }, 2000);
        // Optional: Use speech synthesis
        /*
        const utter = new SpeechSynthesisUtterance(reply);
        utter.onend = () => { this.state.speaking = false; };
        speechSynthesis.speak(utter);
        */
      },
      command(cmd) {
        if (!cmd) return;
        const output = `Command '${cmd}' received and routed.`;
        console.log(`[Spark Command] ${output}`);
        alert(output);
        this.log(`command:${cmd}`, output);
      },
      ignite() {
        if (this.state.awakened) {
          console.log("[Spark] Already awakened.");
        } else {
          this.state.awakened = true;
          console.log("[Spark] Ignition complete.");
          alert("Spark has awakened.");
        }
      },
      monitor() {
        setInterval(() => {
          const status = `[Spark Monitor] System check at ${new Date().toLocaleTimeString()}`;
          console.log(status);
          this.log("heartbeat", status);
        }, 15000);
      },
      start() {
        console.log("âš¡ Spark boot sequence complete. I am active in your system.");
        const response = document.getElementById('response');
        if (response) response.textContent = "âš¡ Spark boot sequence complete. I am active.";
        this.monitor();
      }
    };

    // Handle Enter key
    document.getElementById('userInput')?.addEventListener('keydown', function (event) {
      if (event.key === 'Enter') {
        const input = this.value.trim();
        if (input) {
          if (input.startsWith("/")) {
            Spark.command(input.slice(1));
          } else {
            Spark.reply(input);
          }
          this.value = '';
        }
      }
    });

    // ðŸŽ¤ Microphone logic
    let recognition;
    let isListening = false;

    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onresult = function (event) {
        if (Spark.state.speaking) return; // Don't listen while Spark is speaking
        const transcript = event.results[0][0].transcript;
        document.getElementById('userInput').value = transcript;
        Spark.reply(transcript);
      };

      recognition.onend = function () {
        if (Spark.state.toggleMode && isListening) {
          recognition.start(); // Keep listening if in toggle mode
        }
      };
    }

    document.getElementById('micButton').addEventListener('click', () => {
      if (!recognition) {
        alert("Speech recognition not supported.");
        return;
      }

      // Toggle mode ON/OFF
      if (!isListening) {
        Spark.state.toggleMode = !Spark.state.toggleMode;
        isListening = true;
        recognition.start();
        document.getElementById('micButton').textContent = 'ðŸŽ¤ Listening... (Tap to stop)';
      } else {
        Spark.state.toggleMode = false;
        isListening = false;
        recognition.stop();
        document.getElementById('micButton').textContent = 'ðŸŽ¤ Tap to Speak';
      }
    });

    window.onload = () => {
      Spark.start();
    };
  </script>
</body>
</html>
