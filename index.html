<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spark Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #111;
      color: #f5eddc;
    }
    #mic {
      font-size: 24px;
      padding: 10px;
    }
    #response {
      margin-top: 20px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <h1>ðŸ”¥ Spark Assistant</h1>
  <button id="mic">ðŸŽ¤ Speak</button>
  <div id="response">Waiting for input...</div>

  <!-- Load memory system -->
  <script src="memery.js"></script>

  <!-- Main assistant script -->
  <script>
    const OPENAI_API_KEY = "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";

    const micButton = document.getElementById("mic");
    const responseBox = document.getElementById("response");
    const synth = window.speechSynthesis;
    const recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recog;

    if (recognition) {
      recog = new recognition();
      recog.continuous = false;
      recog.interimResults = false;
      recog.lang = 'en-US';

      recog.onresult = async (event) => {
        const transcript = event.results[0][0].transcript;
        responseBox.textContent = "You said: " + transcript;
        getOpenAIResponse(transcript);
      };

      recog.onerror = (e) => {
        responseBox.textContent = "Mic error: " + e.error;
      };
    } else {
      micButton.disabled = true;
      responseBox.textContent = "Speech Recognition not supported.";
    }

    micButton.onclick = () => {
      if (recog) {
        recog.start();
        responseBox.textContent = "Listening...";
      }
    };

    async function getOpenAIResponse(prompt) {
      try {
        const result = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{ role: "user", content: prompt }],
            max_tokens: 200,
            temperature: 0.7
          })
        });

        const data = await result.json();
        const reply = data.choices?.[0]?.message?.content || "No response.";
        responseBox.textContent = "âœ¨ Spark: " + reply;
        MEM.addHistory(prompt, reply);
        speak(reply);
      } catch (err) {
        responseBox.textContent = "âš ï¸ Error getting response from OpenAI.";
        console.error(err);
      }
    }

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "en-US";
      synth.speak(utter);
    }

    window.onload = () => {
      if (MEM && MEM.loadMemory) {
        MEM.loadMemory();
        console.log("ðŸ§  Memory loaded:", MEM.memory);
      }
    };
  </script>
</body>
</html>
